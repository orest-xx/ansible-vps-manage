# Ansible Playbook to Install and Configure GaiaNet Node

This Ansible playbook automates the process of installing and configuring a **GaiaNet node**, setting up the environment, and initializing a bot to run with a specific API URL based on the node ID. The playbook can also handle the installation of required dependencies and manage system updates, all while ensuring non-interactive execution.

## Prerequisites

Before running this playbook, ensure you have the following:

1. **Ansible** installed on the control machine.
2. **SSH access** to the target servers (Gaia nodes) where the playbook will be executed.
3. **Root or sudo privileges** on the target machines, as the playbook requires elevated privileges to install software and configure system settings.
4. **A basic understanding of GaiaNet** and the node initialization process.

## Playbook Overview

The playbook performs the following tasks:

1. **Update system packages** (commented out by default).
2. **Install required dependencies** (e.g., curl, jq, git, nano, etc. â€“ also commented out by default).
3. **Install GaiaNet node** if it's not already installed.
4. **Initialize GaiaNet node** with a stable configuration.
5. **Start the GaiaNet node** to begin running.
6. **Capture node ID and device ID** using `gaianet info` and construct the API URL based on the node ID.
7. **Clone the GaiaNet repository** for running the bot.
8. **Run a bot script** using the constructed API URL and a screen session to manage it.
9. **Reboot the system** if needed (after updates) and wait for it to come back online.
10. **Provide debugging information** to verify node and bot status.

## How to Use

### 1. Clone the Repository

If the playbook is part of a larger repository, you can clone the repo to your machine:

```bash
git clone https://github.com/your-repo/ansible-vps-manage.git
cd ansible-vps-manage
```

### 2. Edit the Inventory File
You need to define the gaia_nodes in your Ansible inventory file. Example:
```bash
[gaia_nodes]
node1.example.com
node2.example.com
```
This file can be named hosts or inventory and placed in the root of your project directory.

### 3. Configure Variables (Optional)
In the playbook, the api_url variable is defined with a default value:

```yaml
api_url: "https://default_node_id.us.gaianet.network/v1/chat/completions"
```
This is just a fallback in case the node ID is not correctly fetched. The playbook will attempt to fetch the node_id from the GaiaNet node and use it to construct the correct API URL.

### 4. Run the Playbook
Once everything is set up, run the playbook with the following command:

```bash
ansible-playbook -i inventory/inventory.ini playbooks/gaianet_setup.yml

ansible-playbook -i inventory/inventory.ini playbooks/rivalz.yml
```
This will execute the playbook on all hosts defined in your inventory file under the gaia_nodes group.

### 5. Monitor the Output
The playbook includes debug tasks to show key outputs such as the node ID, device ID, and the final API URL. It will also display success messages when the bot is initialized and running.

### Key Variables
- api_url: The base API URL for GaiaNet. This will be constructed dynamically using the node_id.

- node_id: Extracted from the gaianet info command, this is used to create the API URL for the bot.

- device_id: Also extracted from gaianet info, this could be used for other purposes if needed.

### Handling Reboots
If the playbook detects that a reboot is required after updates, it will automatically trigger a reboot and wait for the system to come back online before continuing with further tasks.

Example Output
After running the playbook, the output will show something like this:

```markdown
TASK [Show the API URL in debug] ************************************************
ok: [node1.example.com] => {
    "msg": "API_URL is set to: https://0x5fe3c6d6ed39c813b66557deeadfa04417b0a2b8.us.gaianet.network/v1/chat/completions"
} 
```
## Troubleshooting
- GaiaNet node not found: Ensure that the GaiaNet node is installed on the target machine. The playbook checks if it's already installed and attempts to install it if not.
- Bot initialization errors: Check the logs generated by the bot_gaia.sh script. If it's failing, ensure that the bot script is set up correctly and that the correct API URL is being used.
## License
This playbook is provided under the MIT License.